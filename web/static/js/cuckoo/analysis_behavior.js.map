{"version":3,"sources":["src/analysis_behavior.js"],"names":[],"mappings":"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","file":"analysis_behavior.js","sourcesContent":["/*\n * Copyright (C) 2010-2013 Claudio Guarnieri.\n * Copyright (C) 2014-2016 Cuckoo Foundation.\n * This file is part of Cuckoo Sandbox - http://www.cuckoosandbox.org\n * See the file 'docs/LICENSE' for copying permission.\n *\n */\n\n// @TO-DO: cleanup jQuery selectors / comment code / trigger loading indicator\n\nclass SummaryBehaviorDetail {\n    constructor(task_id, pname, pid, category, val) {\n        this.task_id = task_id;\n        this.pname = pname;\n        this.pid = pid;\n        this.category = category;\n        this.val = val;\n        this.limit = 5;\n        this.offset = 0;\n\n        this._setup = false;\n        this._sel = $(`section#summary div#summary_${this.category}`);\n    }\n\n    start(offset, limit){\n        let params = {\n            \"task_id\": this.task_id,\n            \"pid\": this.pid,\n            \"watcher\": this.val,\n            \"pname\": this.pname\n        };\n\n        if(offset != null) params[\"offset\"] = offset;\n        else params[\"offset\"] = this.offset;\n        if(limit != null) params[\"limit\"] = limit;\n        else params[\"limit\"] = this.limit;\n\n        let self = this;\n\n        CuckooWeb.api_post(\"/analysis/api/behavior_get_watcher/\", params, function(data){ self.start_cb(data, self); });\n    }\n\n    _setup_html(context){\n        let html = `\n            <li id=\"cat_${context.val}\" class=\"list-group-item\">\n                <p><b>${context.val}</b></p>\n                <ul id=\"${context.val}\"></ul>\n                <p class=\"btn_action\">\n                    <span class=\"load_more\">Load more</span> | <span class=\"load_all\">Load all</span>\n                </p>\n            </li>`;\n\n        context._sel.find(`ul#${context.pid}`).append(html);\n        context._sel.find(`ul#${context.pid} #cat_${context.val} .btn_action .load_more`).click(function(){ context.more(); });\n        context._sel.find(`ul#${context.pid} #cat_${context.val} .btn_action .load_all`).click(function(){ context.all(); });\n\n        context._setup = true;\n    }\n\n    start_cb(data, context){\n        if(!context._setup) context._setup_html(context);\n        let sel = context._sel.find(`ul#${context.pid} #cat_${context.val}`);\n\n        if(data[\"data\"].length < context.limit && context.offset != 0){\n            sel.find(\".btn_action\").html(`<span class=\"no_results\">No more results...</span>`);\n        } else if (data[\"data\"].length < context.limit && context.offset == 0){\n            sel.find(\".btn_action\").hide();\n        }\n\n        let html = \"\";\n        data[\"data\"].forEach(function(obj, i){\n            html += `<li>${obj}</li>`;\n        });\n\n        sel.find(`ul#${context.val}`).append(html);\n    }\n\n    /**\n     * Lazyloads more list items\n     * @return\n     */\n    more(){\n        this.offset += this.limit;\n        this.start();\n    }\n\n    /**\n     * Clears the list and fetches everything\n     * @return\n     */\n    all(){\n        SummaryBehaviorDetail.clear_list(this);\n        SummaryBehaviorDetail.clear_ctrl_btns(this);\n\n        this.start(0,0); // fetch all\n    }\n\n    /**\n     * Clears li items\n     * @return\n     */\n    static clear_list(context){\n        context._sel.find(`ul#${context.pid} #cat_${context.val} ul#${context.val}`).html(\"\");\n    }\n\n    /**\n     * Clears the buttons\n     * @return\n     */\n    static clear_ctrl_btns(context){\n        context._sel.find(`ul#${context.pid} #cat_${context.val} .btn_action`).hide();\n    }\n}\n\nclass SummaryBehaviorController {\n    constructor(task_id, pname, pid) {\n        this.task_id = task_id;\n        this.pname = pname;\n        this.pid = pid;\n        this.loading = false;\n\n        this.behavioral_details = [];\n    }\n\n    start(){\n        let params = {\"task_id\": this.task_id, \"pid\": this.pid};\n        let self = this;\n\n        CuckooWeb.api_post(\"/analysis/api/behavior_get_watchers/\", params,\n            function(data){ self.start_cb(data, self); });\n    }\n\n    start_cb(data, context){\n        $.each(data[\"data\"], function(key, val){\n            let category = key;\n\n            let sel = $(`div#summary_${category}`);\n            sel.append(`\n                <div class=\"panel panel-default\">\n                    <div class=\"panel-heading\"><h3 class=\"panel-title\">${context.pname} <small>pid: ${context.pid}</small></h3></div>\n                    <ul id=\"${context.pid}\" class=\"list-group\">\n                    </ul>\n                </div>`);\n\n            $.each(val, function(i, obj){\n                var behavior_detail = new SummaryBehaviorDetail(context.task_id, context.pname, context.pid, category, obj);\n                behavior_detail.start();\n                context.behavioral_details.push(behavior_detail)\n            });\n        });\n    }\n\n    static toggle_loading(){\n        if(this.loading){\n            $(\".loading\").hide();\n            this.loading = false;\n        } else {\n            $(\".loading\").show();\n            this.loading = true;\n        }\n    }\n}\n"]}