{"version":3,"sources":["src/filetree.js"],"names":[],"mappings":"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","file":"filetree.js","sourcesContent":["class FileTree {\n    constructor(target, convert_data) {\n        this.sel_target = target;\n        this.data = null;\n        this._convert_data = convert_data;\n\n        this._jstree = null;\n    }\n\n    /**\n     * Draws the table\n     */\n    draw(data){\n        if (!this.sel_target) throw \"drawtarget needed\";\n        this.data = data;\n\n        this.init();\n    }\n\n    _convert_entry(entry){\n        let _self = this;\n\n        // container\n        let obj = {\n            filepath: entry.filepath,\n            filename: entry.filename,\n            type: entry.type,\n            state: false, // pre-selected\n            magic: entry.magic,\n            size: entry.size,\n            mime: entry.mime,\n            opened: false // pre-opened\n        };\n\n        // sanatize object properties\n        if(obj.magic){\n            if(obj.magic.length >= 170){ obj.magic = `${obj.magic.substring(0, 170)}...`; }\n        } else {\n            obj.magic = \"empty\";\n        }\n\n        [\".exe\", \".pdf\", \".vbs\", \".vba\", \".bat\", \".py\", \".pyc\", \".pl\", \".rb\", \"js\", \".jse\", \".jar\"].forEach(function (x) {\n            if (obj.filepath.endsWith(x)) {\n                obj.type = \"exec\";\n                obj.state = true;\n            }\n        });\n\n        [\".doc\", \".docx\", \".docm\", \".dotx\", \".dotm\", \".docb\", \".xltm\", \".xls\", \".xltx\", \".xlsm\", \".xlsx\", \".xlt\", \".ppt\", \".pps\", \".pot\"].forEach(function (x) {\n            if (obj.filepath.endsWith(x)) {\n                obj.type = \"office\";\n                obj.state = true;\n            }\n        });\n\n        // build jstree JSON object\n        let data = {\n            text: obj.filename,\n            type: obj.type,\n            state: {\n                \"selected\": obj.state,\n                \"opened\": obj.opened\n            }\n        };\n\n        if(obj.type != \"directory\") {\n            data[\"data\"] = {\n                \"mime\": obj.mime,\n                \"size\": obj.size,\n                \"magic\": obj.magic\n            };\n\n            if(entry.children.length >= 1) {\n                data.type = \"archive\";\n                data.state.opened = true;\n            }\n        }\n\n        // recurse for child entries (make jstree leafs)\n        if(entry.children.length >= 1){\n            entry.children.forEach(function(e){\n                if(!data.hasOwnProperty(\"children\")) { data.children = []; }\n                data.children.push(_self._convert_entry(e));\n            })\n        }\n\n        return data;\n    }\n\n    /**\n     * Init the table\n     */\n    init(){\n        $(this.sel_target).empty();\n\n        let data = this.data;\n\n        // Convert the data from the `sflock` format to jstree JSON data if necessary\n        if(this._convert_data){\n            var data_tmp = [];\n            for (var key in data) {\n                if (data.hasOwnProperty(key)) {\n                    data_tmp.push(this._convert_entry(data[key]));\n                }\n            }\n\n            data = data_tmp;\n        }\n\n        $(this.sel_target).jstree({\n            core: {\n                data: data,\n                \"multiple\" : true,\n                \"animation\" : 0,\n                \"themes\": {\n                    \"name\": \"default-dark\"\n                }\n            },\n            types: {\n                \"archive\": {\n                    \"icon\": \"fa fa-file-archive-o\"\n                },\n                \"file\": {\n                    \"icon\": \"fa fa-file-o\"\n                },\n                \"exec\": {\n                    \"icon\": \"fa fa-file-text\"\n                },\n                \"office\": {\n                    \"icon\": \"fa fa-file-word-o\"\n                }\n            },\n            grid: {\n                columns: [\n                    {width: 'auto', header: 'File'},\n                    {width: 'auto', header: 'Mime', value: 'mime'},\n                    {width: 'auto', header: 'Size', value: 'size'},\n                    {width: '10px', header: 'Magic', value: 'magic'}\n                ],\n                resizable: true\n            },\n            plugins: [\"themes\", \"types\", \"checkbox\", \"grid\", \"wholerow\"]\n        })\n//        .on('open_node.jstree', function (e, data) {\n//            data.instance.set_icon(data.node, \"fa fa-file-archive-o\");\n//        }).on('close_node.jstree', function (e, data) {\n//            data.instance.set_icon(data.node, \"fa fa-file-archive-o\");\n//        })\n        ;\n\n    }\n}"]}