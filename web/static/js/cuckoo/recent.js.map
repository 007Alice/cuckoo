{"version":3,"sources":["src/recent.js"],"names":[],"mappings":";;;;;;AAAA;;;;;;;;IAQM,M;AACF,sBAAc;AAAA;;AACV,aAAK,OAAL,GAAe,KAAf;AACA,aAAK,KAAL,GAAa,GAAb;AACA,aAAK,MAAL,GAAc,CAAd;AACA,aAAK,aAAL,GAAqB,KAArB;;AAEA,aAAK,MAAL,GAAc;AACV,oBAAQ,EADE;AAEV,qBAAS,EAFC;AAGV,qBAAS;AAHC,SAAd;AAKH;;;;yCAEe;AACZ,gBAAG,KAAK,OAAR,EAAgB;AACZ,kBAAE,UAAF,EAAc,IAAd;AACA,qBAAK,OAAL,GAAe,KAAf;AACH,aAHD,MAGO;AACH,kBAAE,UAAF,EAAc,IAAd;AACA,qBAAK,OAAL,GAAe,IAAf;AACH;AACJ;;;wCAEc;AACX;AACA,cAAE,qBAAF,EAAyB,IAAzB;;AAEA,qBAAS,SAAT,CAAmB,WAAnB,EAA+B;AAC3B,uBAAO,2CAAyC,WAAzC,QAAyD,MAAzD,GAAkE,QAAlE,CAA2E,QAA3E,CAAP;AACH;;AAED,gBAAG,UAAU,WAAV,CAAH,EAA2B,KAAK,MAAL,CAAY,MAAZ,EAAoB,IAApB,CAAyB,MAAzB;AAC3B,gBAAG,UAAU,UAAV,CAAH,EAA0B,KAAK,MAAL,CAAY,MAAZ,EAAoB,IAApB,CAAyB,KAAzB;;AAE1B,gBAAG,UAAU,WAAV,CAAH,EAA2B;AACvB,qBAAK,MAAL,CAAY,OAAZ,IAAuB,KAAvB;AACH,aAFD,MAEO,IAAI,UAAU,WAAV,CAAJ,EAA4B;AAC/B,qBAAK,MAAL,CAAY,OAAZ,IAAuB,KAAvB;AACH,aAFM,MAEA,IAAI,UAAU,YAAV,CAAJ,EAA6B;AAChC,qBAAK,MAAL,CAAY,OAAZ,IAAuB,MAAvB;AACH;;AAED;AACA;;AAEA,mBAAO,KAAK,MAAZ;AACH;;AAED;;;;;;;;;oCAMW;AACP,gBAAI,SAAS,KAAK,aAAL,EAAb;AACA,mBAAO,QAAP,IAAmB,KAAK,MAAxB;AACA,mBAAO,OAAP,IAAkB,KAAK,KAAvB;;AAEA,gBAAI,OAAO,IAAX;;AAEA,qBAAS,EAAT,CAAY,IAAZ,EAAiB;AACb,qBAAK,gBAAL,CAAsB,IAAtB;AACA,qBAAK,cAAL,CAAoB,IAApB;AACH;;AAED,qBAAS,UAAT,GAAqB;AACjB,qBAAK,cAAL,CAAoB,IAApB;AACH;;AAED,qBAAS,aAAT,EAAwB,MAAxB,EAAgC,EAAhC,EAAoC,IAApC,EAA0C,UAA1C;AACH;;;+BAEK;AACF,cAAE,eAAF,EAAmB,IAAnB,CAAwB,EAAxB;AACA,iBAAK,aAAL,GAAqB,KAArB;AACA,iBAAK,MAAL,GAAc,CAAd;AACA,iBAAK,MAAL,GAAc;AACV,wBAAQ,EADE;AAEV,yBAAS,EAFC;AAGV,yBAAS;AAHC,aAAd;AAKA,iBAAK,SAAL;AACH;;;oCAEU;AACP,iBAAK,MAAL,IAAe,KAAK,KAApB;AACA,iBAAK,SAAL;AACH;;;yCAEgB,I,EAAK;AAClB,gBAAG,OAAO,IAAP,CAAY,IAAZ,EAAkB,MAAlB,IAA4B,CAA/B,EAAiC;AAC7B,kBAAE,qBAAF,EAAyB,IAAzB;AACA,kBAAE,0BAAF,EAA8B,IAA9B,CAAmC,iBAAnC;AACA,qBAAK,aAAL,GAAqB,IAArB;AACH,aAJD,MAIO;AACH,qBAAK,OAAL,CAAa,UAAU,QAAV,EAAoB,CAApB,EAAsB;AAC/B,wBAAI,OAAO,UAAX;;AAEA,yCAAmB,SAAS,IAAT,CAAnB;;AAEA,wBAAI,oBAAoB,GAAxB;AACA,wBAAI,gBAAgB,GAApB;;AAEA,wBAAI,SAAS,cAAT,CAAwB,cAAxB,CAAJ,EAA6C,oBAAoB,OAAO,gBAAP,CAAwB,SAAS,YAAjC,CAApB;AAC7C,wBAAI,SAAS,cAAT,CAAwB,UAAxB,CAAJ,EAAyC,gBAAgB,OAAO,gBAAP,CAAwB,SAAS,QAAjC,CAAhB;;AAEzC,wBAAI,SAAS,MAAT,IAAmB,UAAnB,IAAiC,SAAS,MAAT,IAAmB,iBAAxD,EAA2E;AACvE,+CAAoB,SAAS,EAA7B,wCAA+D,iBAA/D;AACH,qBAFD,MAEO;AACH,2DAA+B,aAA/B;AACH;;AAED,4BAAQ,WAAR;;AAEA,wBAAI,aAAa,GAAjB;AACA,wBAAG,SAAS,MAAZ,EAAoB;AAChB,qCAAa,SAAS,MAAT,CAAgB,GAA7B;AACH;;AAED,wBAAI,SAAS,MAAT,IAAmB,UAAnB,IAAiC,SAAS,MAAT,IAAmB,iBAAxD,EAA2E;AACvE,+CAAoB,SAAS,EAA7B,wCAA+D,UAA/D;AACH,qBAFD,MAEO;AACH,0DAA8B,UAA9B;AACH;;AAED,4BAAQ,WAAR;;AAEA,wBAAI,SAAS,MAAT,IAAmB,UAAnB,IAAiC,SAAS,MAAT,IAAmB,iBAAxD,EAA2E;AACvE,+CAAoB,SAAS,EAA7B,mBAA4C,SAAS,YAArD;AACH,qBAFD,MAEO;AACH,gCAAQ,SAAS,QAAjB;AACH;;AAED,4BAAQ,WAAR;;AAEA,wBAAI,SAAS,MAAT,IAAmB,SAAvB,EAAkC;AAC9B,gCAAQ,yCAAR;AACH,qBAFD,MAEO,IAAI,SAAS,MAAT,IAAmB,SAAvB,EAAkC;AACrC,gCAAQ,2CAAR;AACH,qBAFM,MAEA,IAAI,SAAS,MAAT,IAAmB,WAAvB,EAAoC;AACvC,gCAAQ,0CAAR;AACH,qBAFM,MAEA,IAAI,SAAS,MAAT,IAAmB,UAAvB,EAAmC;AACtC,4BAAI,SAAS,MAAb,EAAqB;AACjB,oCAAQ,4BAAR;AACH,yBAFD,MAEO;AACH,oCAAQ,6BAAR;AACH;;AAED,gCAAQ,iBAAR;AACH,qBARM,MAQA;AACH,iEAAqC,SAAS,MAA9C;AACH;;AAED,4BAAQ,WAAR;;AAEA,wBAAI,cAAc,SAAlB;AACA,wBAAG,SAAS,cAAT,CAAwB,OAAxB,CAAH,EAAqC;AACjC,4BAAI,SAAS,KAAT,IAAkB,CAAlB,IAAuB,SAAS,KAAT,IAAkB,CAA7C,EAAgD,cAAc,SAAd,CAAhD,KACK,IAAI,SAAS,KAAT,GAAiB,CAArB,EAAwB,cAAc,QAAd;AAChC;;AAED,2DAAoC,WAApC,kBAA2D,SAAS,KAApE;AACA,4BAAQ,YAAR;;AAEA,sBAAE,oBAAF,EAAwB,MAAxB,CAA+B,IAA/B;AACH,iBAtED;AAuEH;AACJ;;;yCAEuB,Q,EAAU;AAC9B,gBAAI,OAAO,IAAI,IAAJ,CAAS,QAAT,CAAX;;AAEA,gBAAI,QAAQ,KAAK,QAAL,KAAkB,CAA9B;AACA,gBAAI,MAAM,KAAK,OAAL,EAAV;AACA,gBAAI,OAAO,KAAK,QAAL,EAAX;AACA,gBAAI,MAAM,KAAK,UAAL,EAAV;AACA,gBAAI,MAAM,KAAK,UAAL,EAAV;;AAEA,oBAAQ,CAAC,QAAQ,EAAR,GAAa,GAAb,GAAmB,EAApB,IAA0B,KAAlC;AACA,kBAAM,CAAC,MAAM,EAAN,GAAW,GAAX,GAAiB,EAAlB,IAAwB,GAA9B;AACA,mBAAO,CAAC,OAAO,EAAP,GAAY,GAAZ,GAAkB,EAAnB,IAAyB,IAAhC;AACA,kBAAM,CAAC,MAAM,EAAN,GAAW,GAAX,GAAiB,EAAlB,IAAwB,GAA9B;AACA,kBAAM,CAAC,MAAM,EAAN,GAAW,GAAX,GAAiB,EAAlB,IAAwB,GAA9B;;AAEA,mBAAO,KAAK,WAAL,KAAqB,GAArB,GAA2B,KAA3B,GAAmC,GAAnC,GAAyC,GAAzC,GAA+C,GAA/C,GAAsD,IAAtD,GAA6D,GAA7D,GAAmE,GAA1E;AACH","file":"recent.js","sourcesContent":["/*\n * Copyright (C) 2010-2013 Claudio Guarnieri.\n * Copyright (C) 2014-2016 Cuckoo Foundation.\n * This file is part of Cuckoo Sandbox - http://www.cuckoosandbox.org\n * See the file 'docs/LICENSE' for copying permission.\n *\n */\n\nclass Recent {\n    constructor() {\n        this.loading = false;\n        this.limit = 100;\n        this.offset = 0;\n        this.empty_results = false;\n\n        this.params = {\n            \"cats\": [],\n            \"packs\": [],\n            \"score\": \"\"\n        };\n    }\n\n    toggle_loading(){\n        if(this.loading){\n            $(\".loading\").hide();\n            this.loading = false;\n        } else {\n            $(\".loading\").show();\n            this.loading = true;\n        }\n    }\n\n    gather_params(){\n        // reset everything to default values\n        $(\"div#no_more_results\").hide();\n\n        function is_active(data_filter){\n            return $(`div.nav_container>div a[data-filter=${data_filter}]`).parent().hasClass(\"active\");\n        }\n\n        if(is_active(\"cat_files\")) this.params[\"cats\"].push(\"file\");\n        if(is_active(\"cat_urls\")) this.params[\"cats\"].push(\"url\");\n\n        if(is_active(\"score_0-4\")) {\n            this.params[\"score\"] = \"0-4\";\n        } else if (is_active(\"score_4-7\")) {\n            this.params[\"score\"] = \"4-7\";\n        } else if (is_active(\"score_7-10\")) {\n            this.params[\"score\"] = \"7-10\";\n        }\n\n        //if(is_active('pack_pdf')) this.params['packs'].push('pdf');\n        //if(is_active('pack_office')) this.params['packs'].push('office');\n\n        return this.params\n    }\n\n    /**\n     * Contacts API\n     * @param {Object} [params] - filters\n     * @param {Function} callback - the callback function\n     * @return\n     */\n    get_tasks(){\n        let params = this.gather_params();\n        params[\"offset\"] = this.offset;\n        params[\"limit\"] = this.limit;\n\n        let self = this;\n\n        function cb(data){\n            self.results_callback(data);\n            self.toggle_loading(self);\n        }\n\n        function beforesend(){\n            self.toggle_loading(self);\n        }\n\n        api_post(\"api/recent/\", params, cb, null, beforesend);\n    }\n\n    load(){\n        $(\"#recent>tbody\").html(\"\");\n        this.empty_results = false;\n        this.offset = 0;\n        this.params = {\n            \"cats\": [],\n            \"packs\": [],\n            \"score\": \"\"\n        };\n        this.get_tasks();\n    }\n\n    lazy_load(){\n        this.offset += this.limit;\n        this.get_tasks();\n    }\n\n    results_callback(data){\n        if(Object.keys(data).length == 0){\n            $(\"div#no_more_results\").show();\n            $(\"div#no_more_results>span\").html(\"no more results\");\n            this.empty_results = true;\n        } else {\n            data.forEach(function (analysis, i){\n                let html = \"<tr><td>\";\n\n                html += `<strong>${analysis[\"id\"]}</strong></td><td>`;\n\n                let date_completed_on = \"-\";\n                let date_added_on = \"-\";\n\n                if (analysis.hasOwnProperty(\"completed_on\")) date_completed_on = Recent.getFormattedDate(analysis.completed_on);\n                if (analysis.hasOwnProperty(\"added_on\")) date_added_on = Recent.getFormattedDate(analysis.added_on);\n\n                if (analysis.status == \"reported\" || analysis.status == \"failed_analysis\") {\n                    html += `<a href=\"${analysis.id}/summary\"><span class=\"mono\">${date_completed_on}</span></a>`;\n                } else {\n                    html += `<span class=\"muted\">${date_added_on}</span>`;\n                }\n\n                html += \"</td><td>\";\n\n                var identifier = \"-\";\n                if(analysis.sample) {\n                    identifier = analysis.sample.md5;\n                }\n\n                if (analysis.status == \"reported\" || analysis.status == \"failed_analysis\") {\n                    html += `<a href=\"${analysis.id}/summary\"><span class=\"mono\">${identifier}</span></a>`;\n                } else {\n                    html += `<span class=\"mono\">${identifier}</span>`;\n                }\n\n                html += \"</td><td>\";\n\n                if (analysis.status == \"reported\" || analysis.status == \"failed_analysis\") {\n                    html += `<a href=\"${analysis.id}/summary\">${analysis.filename_url}</a>`;\n                } else {\n                    html += analysis.category;\n                }\n\n                html += \"</td><td>\";\n\n                if (analysis.status == \"pending\") {\n                    html += '<span class=\"text-muted\">pending</span>';\n                } else if (analysis.status == \"running\") {\n                    html += '<span class=\"text-warning\">running</span>';\n                } else if (analysis.status == \"completed\") {\n                    html += '<span class=\"text-info\">completed</span>';\n                } else if (analysis.status == \"reported\") {\n                    if (analysis.errors) {\n                        html += '<span class=\"text-danger\">';\n                    } else {\n                        html += '<span class=\"text-success\">';\n                    }\n\n                    html += \"reported</span>\";\n                } else {\n                    html += `<span class=\"text-danger\">${analysis.status}</span>`;\n                }\n\n                html += \"</td><td>\";\n\n                let badge_color = \"default\";\n                if(analysis.hasOwnProperty(\"score\")) {\n                    if (analysis.score >= 4 && analysis.score <= 7) badge_color = \"warning\";\n                    else if (analysis.score > 7) badge_color = \"danger\";\n                }\n\n                html += `<span class=\"badge badge-${badge_color}\">score: ${analysis.score}</span>`;\n                html += \"</td></tr>\";\n\n                $(\"table#recent tbody\").append(html);\n            });\n        }\n    }\n\n    static getFormattedDate(jsondate) {\n        var date = new Date(jsondate);\n\n        var month = date.getMonth() + 1;\n        var day = date.getDate();\n        var hour = date.getHours();\n        var min = date.getMinutes();\n        var sec = date.getSeconds();\n\n        month = (month < 10 ? \"0\" : \"\") + month;\n        day = (day < 10 ? \"0\" : \"\") + day;\n        hour = (hour < 10 ? \"0\" : \"\") + hour;\n        min = (min < 10 ? \"0\" : \"\") + min;\n        sec = (sec < 10 ? \"0\" : \"\") + sec;\n\n        return date.getFullYear() + \"-\" + month + \"-\" + day + \" \" +  hour + \":\" + min;\n    }\n}\n"]}