"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),FileTree=function(){function e(t,a,i,s){_classCallCheck(this,e),this.sel_target=t,this.data=a,this._draw_callback=s,this._convert_from_sflock=i,this._filters={simplify_mime:!0,simplify_magic:!0,simplify_sizes:!0,deselect_duplicates:!0},this.stats={duplicates:0,files:0,containers:0,directories:0,executables:0,urls:0}}return _createClass(e,[{key:"draw",value:function(){if(!this.sel_target)throw"drawtarget needed";this._init(),this._draw_callback()}},{key:"refresh",value:function(){this._reset_stats();var e=null;e=this._convert_from_sflock?this._convert_sflock():this.data,$(this.sel_target).jstree(!0).settings.core.data=e,$(this.sel_target).jstree(!0).refresh(),this._draw_callback()}},{key:"_init",value:function(){var e=null;e=this._convert_from_sflock?this._convert_sflock():this.data;var t=Cookies.get("theme"),a={name:"default"};"night"!=t&&"cyborg"!=t||(a.name="default-dark"),$(this.sel_target).jstree({core:{data:e,multiple:!0,animation:0,themes:a},checkbox:{three_state:!1,cascade:"undetermined"},types:{container:{icon:"fa fa-file-archive-o"},file:{icon:"fa fa-file-o"},exec:{icon:"fa fa-file-text"},office:{icon:"fa fa-file-word-o"},duplicate:{icon:"fa fa-ban"},url:{icon:"fa fa-external-link"}},grid:{columns:[{width:"auto",header:"File"},{width:"auto",header:"Package",value:"package"},{width:"auto",header:"Mime",value:"mime"},{width:"auto",header:"Size",value:"size"},{width:"10px",header:"Magic",value:"magic"}],resizable:!0},plugins:["themes","types","checkbox","grid","wholerow"]}),$(this.sel_target).bind("ready.jstree",function(){var e=$(".jstree-grid-wrapper");e.css("min-height",e.outerHeight())})}},{key:"_convert_sflock",value:function(){var e=$.extend({},this.data),t=[];for(var a in e)if(e.hasOwnProperty(a)){var i=e[a],s=void 0;s=i.hasOwnProperty("type")&&"container"==i.type?this._convert_entry(e[a],i.filename):this._convert_entry(e[a],""),t.push(s)}return t}},{key:"_convert_entry",value:function(e,t){var a=this;"undefined"===e.size&&(e.size=0),e.extrpath=e.extrpath?e.extrpath:[],e.extrpath?e.filepath=t+"/"+e.extrpath.join("/"):!e.filepath&&e.relapath?e.filepath=e.relapath:e.relapath||(e.relapath=e.filepath);var i={text:e.filename,data:{},a_attr:{sha256:e.sha256,package:e.package,type:e.type}};return e.hasOwnProperty("package")&&(i.data.package=e.package),"directory"==e.type?(e.type="directory",e.opened=!0,i.state={opened:e.opened},a.stats.directories+=1):(i.data.mime=e.mime,i.data.size=e.size,i.data.magic=e.magic,"url"==e.type?(a.stats.urls+=1,a.stats.files+=1):a.stats.files+=1,this._filters.simplify_magic?e.magic=e.finger.magic_human:e.magic=e.finger.magic,this._filters.simplify_mime?e.mime=e.finger.mime_human:e.mime=e.finger.mime,this._filters.simplify_sizes&&!e.size instanceof String&&(e.size=CuckooWeb.human_size(e.size,!0)),e.magic?e.magic.length>=170&&(e.magic=e.magic.substring(0,170)+"..."):e.magic="Empty",[".exe",".pdf",".vbs",".vba",".bat",".py",".pyc",".pl",".rb",".js",".jse"].forEach(function(t){e.filepath.endsWith(t)&&(e.type="exec",e.state=!0,a.stats.executables+=1)}),[".doc",".docx",".docm",".dotx",".dotm",".docb",".xltm",".xls",".xltx",".xlsm",".xlsx",".xlt",".ppt",".pps",".pot"].forEach(function(t){e.filepath.endsWith(t)&&(e.type="office",e.state=!0,a.stats.executables+=1)}),e.state=e.selected,e.duplicate&&(e.type="duplicate",this._filters.deselect_duplicates&&(e.state=!1),i.a_attr.filetree_duplicate="true",a.stats.duplicates+=1),i.a_attr.filepath=e.extrpath.unshift(t)?e.extrpath:[e.filepath],e.children.length>=1&&(e.type="container",e.opened=!0,a.stats.containers+=1),i.a_attr.filetree_type=e.type,i.type=e.type,i.state={selected:e.state,opened:e.opened}),e.children.length>=1&&e.children.forEach(function(e){i.hasOwnProperty("children")||(i.children=[]),i.children.push(a._convert_entry(e,t))}),i}},{key:"_reset_stats",value:function(){this.stats={duplicates:0,files:0,containers:0,directories:0,executables:0,urls:0}}},{key:"selected",value:function(){var e=[];return $(this.sel_target).jstree("get_checked",!0,!0).forEach(function(t){return!t.a_attr.hasOwnProperty("filetree_type")||"directory"==t.a_attr.filetree_type||void e.push({filepath:t.a_attr.filepath,filename:t.text,sha256:t.a_attr.sha256,type:t.a_attr.type,package:t.a_attr.package})}),e}},{key:"simplify",value:function(e){this._filters.simplify_mime=e,this._filters.simplify_sizes=e,this._filters.simplify_magic=e,this.refresh()}},{key:"duplicates",value:function(e){this._filters.deselect_duplicates=e,this.refresh()}}],[{key:"highlight",value:function(e,t,a){var i=e.attr("filetree_type"),s=e.attr("filetree_duplicate");"files"==t?"directory"!=i&&(a?e.addClass("highlight"):e.removeClass("highlight")):"exec"==t?"exec"==i&&(a?e.addClass("highlight"):e.removeClass("highlight")):"containers"==t?"container"!=i&&"office"!=i||(a?e.addClass("highlight"):e.removeClass("highlight")):"duplicates"==t?"true"==s&&(a?e.addClass("highlight"):e.removeClass("highlight")):"urls"==t&&"url"==i&&(a?e.addClass("highlight"):e.removeClass("highlight"))}}]),e}();
//# sourceMappingURL=filetree.js.map
