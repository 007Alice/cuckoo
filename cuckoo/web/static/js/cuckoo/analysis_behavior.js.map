{"version":3,"sources":["src/analysis_behavior.js"],"names":[],"mappings":"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","file":"analysis_behavior.js","sourcesContent":["/*\n * Copyright (C) 2010-2013 Claudio Guarnieri.\n * Copyright (C) 2014-2016 Cuckoo Foundation.\n * This file is part of Cuckoo Sandbox - http://www.cuckoosandbox.org\n * See the file 'docs/LICENSE' for copying permission.\n *\n */\n\n// @TO-DO: cleanup jQuery selectors / comment code / trigger loading indicator\n\nclass SummaryBehaviorDetail {\n    constructor(task_id, pname, pid, category, val) {\n        this.task_id = task_id;\n        this.pname = pname;\n        this.pid = pid;\n        this.category = category;\n        this.val = val;\n        this.limit = 5;\n        this.offset = 0;\n\n        this._setup = false;\n        this._sel = $(`section#summary div#summary_${this.category}`);\n    }\n\n    start(offset, limit){\n        let params = {\n            \"task_id\": this.task_id,\n            \"pid\": this.pid,\n            \"watcher\": this.val,\n            \"pname\": this.pname\n        };\n\n        if(offset != null) params[\"offset\"] = offset;\n        else params[\"offset\"] = this.offset;\n        if(limit != null) params[\"limit\"] = limit;\n        else params[\"limit\"] = this.limit;\n\n        let self = this;\n\n        CuckooWeb.api_post(\"/analysis/api/task/behavior_get_watcher/\", params, function(data){ self.start_cb(data, self); });\n    }\n\n    _setup_html(context){\n        let html = `\n            <li id=\"cat_${context.val}\" class=\"list-group-item\">\n                <p><b>${context.val}</b></p>\n                <ul id=\"${context.val}\"></ul>\n                <p class=\"btn_action\">\n                    <span class=\"load_more\">Load more</span> | <span class=\"load_all\">Load all</span>\n                </p>\n            </li>`;\n\n        context._sel.find(`ul#${context.pid}`).append(html);\n        context._sel.find(`ul#${context.pid} #cat_${context.val} .btn_action .load_more`).click(function(){ context.more(); });\n        context._sel.find(`ul#${context.pid} #cat_${context.val} .btn_action .load_all`).click(function(){ context.all(); });\n\n        context._setup = true;\n    }\n\n    start_cb(data, context){\n        if(!context._setup) context._setup_html(context);\n        let sel = context._sel.find(`ul#${context.pid} #cat_${context.val}`);\n\n        if(data[\"data\"].length < context.limit && context.offset != 0){\n            sel.find(\".btn_action\").html(`<span class=\"no_results\">No more results...</span>`);\n        } else if (data[\"data\"].length < context.limit && context.offset == 0){\n            sel.find(\".btn_action\").hide();\n        }\n\n        let html = \"\";\n        data[\"data\"].forEach(function(obj, i){\n            html += `<li>${obj}</li>`;\n        });\n\n        sel.find(`ul#${context.val}`).append(html);\n    }\n\n    /**\n     * Lazyloads more list items\n     * @return\n     */\n    more(){\n        this.offset += this.limit;\n        this.start();\n    }\n\n    /**\n     * Clears the list and fetches everything\n     * @return\n     */\n    all(){\n        SummaryBehaviorDetail.clear_list(this);\n        SummaryBehaviorDetail.clear_ctrl_btns(this);\n\n        this.start(0,0); // fetch all\n    }\n\n    /**\n     * Clears li items\n     * @return\n     */\n    static clear_list(context){\n        context._sel.find(`ul#${context.pid} #cat_${context.val} ul#${context.val}`).html(\"\");\n    }\n\n    /**\n     * Clears the buttons\n     * @return\n     */\n    static clear_ctrl_btns(context){\n        context._sel.find(`ul#${context.pid} #cat_${context.val} .btn_action`).hide();\n    }\n}\n\nclass SummaryBehaviorController {\n    constructor(task_id, pname, pid) {\n        this.task_id = task_id;\n        this.pname = pname;\n        this.pid = pid;\n        this.loading = false;\n\n        this.behavioral_details = [];\n    }\n\n    start(){\n        let params = {\"task_id\": this.task_id, \"pid\": this.pid};\n        let self = this;\n\n        CuckooWeb.api_post(\"/analysis/api/task/behavior_get_watchers/\", params,\n            function(data){ self.start_cb(data, self); });\n    }\n\n    start_cb(data, context){\n        $.each(data[\"data\"], function(key, val){\n            let category = key;\n\n            let sel = $(`div#summary_${category}`);\n            sel.append(`\n                <div class=\"panel panel-default\">\n                    <div class=\"panel-heading\"><h3 class=\"panel-title\">${context.pname} <small>pid: ${context.pid}</small></h3></div>\n                    <ul id=\"${context.pid}\" class=\"list-group\">\n                    </ul>\n                </div>`);\n\n            $.each(val, function(i, obj){\n                var behavior_detail = new SummaryBehaviorDetail(context.task_id, context.pname, context.pid, category, obj);\n                behavior_detail.start();\n                context.behavioral_details.push(behavior_detail)\n            });\n        });\n    }\n\n    static toggle_loading(){\n        if(this.loading){\n            $(\".loading\").hide();\n            this.loading = false;\n        } else {\n            $(\".loading\").show();\n            this.loading = true;\n        }\n    }\n}\n"]}