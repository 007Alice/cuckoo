{"version":3,"sources":["analysis_behavior.js"],"names":["SummaryBehaviorDetail","task_id","pname","pid","category","val","limit","offset","_setup","_sel","$","params","self","CuckooWeb","api_post","data","start_cb","context","html","find","append","click","more","all","_setup_html","sel","length","hide","forEach","obj","i","start","clear_list","clear_ctrl_btns","SummaryBehaviorController","loading","behavioral_details","each","key","behavior_detail","push"],"mappings":"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","file":"analysis_behavior.js","sourcesContent":["/*\n * Copyright (C) 2010-2013 Claudio Guarnieri.\n * Copyright (C) 2014-2016 Cuckoo Foundation.\n * This file is part of Cuckoo Sandbox - http://www.cuckoosandbox.org\n * See the file 'docs/LICENSE' for copying permission.\n *\n */\n\n// @TO-DO: cleanup jQuery selectors / comment code / trigger loading indicator\n\nclass SummaryBehaviorDetail {\n\n    constructor(task_id, pname, pid, category, val) {\n        this.task_id = task_id;\n        this.pname = pname;\n        this.pid = pid;\n        this.category = category;\n        this.val = val;\n        this.limit = 5;\n        this.offset = 0;\n\n        this._setup = false;\n        this._sel = $(`section#summary div#summary_${this.category}`);\n    }\n\n    start(offset, limit){\n        let params = {\n            \"task_id\": this.task_id,\n            \"pid\": this.pid,\n            \"watcher\": this.val,\n            \"pname\": this.pname\n        };\n\n        if(offset != null) params[\"offset\"] = offset;\n        else params[\"offset\"] = this.offset;\n        if(limit != null) params[\"limit\"] = limit;\n        else params[\"limit\"] = this.limit;\n\n        let self = this;\n\n        CuckooWeb.api_post(\"/analysis/api/task/behavior_get_watcher/\", params, function(data){ self.start_cb(data, self); });\n    }\n\n    _setup_html(context){\n        let html = `\n            <li id=\"cat_${context.val}\" class=\"list-group-item\">\n                <p><b>${context.val}</b></p>\n                <ul id=\"${context.val}\"></ul>\n                <p class=\"btn_action\">\n                    <span class=\"load_more\">Load more</span> | <span class=\"load_all\">Load all</span>\n                </p>\n            </li>`;\n\n        context._sel.find(`ul#${context.pid}`).append(html);\n        context._sel.find(`ul#${context.pid} #cat_${context.val} .btn_action .load_more`).click(function(){ context.more(); });\n        context._sel.find(`ul#${context.pid} #cat_${context.val} .btn_action .load_all`).click(function(){ context.all(); });\n\n        context._setup = true;\n    }\n\n    start_cb(data, context){\n        if(!context._setup) context._setup_html(context);\n        let sel = context._sel.find(`ul#${context.pid} #cat_${context.val}`);\n\n        if(data[\"data\"].length < context.limit && context.offset != 0){\n            sel.find(\".btn_action\").html(`<span class=\"no_results\">No more results...</span>`);\n        } else if (data[\"data\"].length < context.limit && context.offset == 0){\n            sel.find(\".btn_action\").hide();\n        }\n\n        let html = \"\";\n        data[\"data\"].forEach(function(obj, i){\n            html += `<li>${obj}</li>`;\n        });\n\n        sel.find(`ul#${context.val}`).append(html);\n    }\n\n    /**\n     * Lazyloads more list items\n     * @return\n     */\n    more(){\n        this.offset += this.limit;\n        this.start();\n    }\n\n    /**\n     * Clears the list and fetches everything\n     * @return\n     */\n    all(){\n        SummaryBehaviorDetail.clear_list(this);\n        SummaryBehaviorDetail.clear_ctrl_btns(this);\n\n        this.start(0,0); // fetch all\n    }\n\n    /**\n     * Clears li items\n     * @return\n     */\n    static clear_list(context){\n        context._sel.find(`ul#${context.pid} #cat_${context.val} ul#${context.val}`).html(\"\");\n    }\n\n    /**\n     * Clears the buttons\n     * @return\n     */\n    static clear_ctrl_btns(context){\n        context._sel.find(`ul#${context.pid} #cat_${context.val} .btn_action`).hide();\n    }\n}\n\nclass SummaryBehaviorController {\n\n    constructor(task_id, pname, pid) {\n        this.task_id = task_id;\n        this.pname = pname;\n        this.pid = pid;\n        this.loading = false;\n\n        this.behavioral_details = [];\n    }\n\n    start(){\n        let params = {\"task_id\": this.task_id, \"pid\": this.pid};\n        let self = this;\n\n        CuckooWeb.api_post(\"/analysis/api/task/behavior_get_watchers/\", params,\n            function(data){ self.start_cb(data, self); });\n    }\n\n    start_cb(data, context){\n        $.each(data[\"data\"], function(key, val){\n            let category = key;\n\n            let sel = $(`div#summary_${category}`);\n            sel.append(`\n                <div class=\"panel panel-default\">\n                    <div class=\"panel-heading\"><h3 class=\"panel-title\">${context.pname} <small>pid: ${context.pid}</small></h3></div>\n                    <ul id=\"${context.pid}\" class=\"list-group\">\n                    </ul>\n                </div>`);\n\n            $.each(val, function(i, obj){\n                var behavior_detail = new SummaryBehaviorDetail(context.task_id, context.pname, context.pid, category, obj);\n                behavior_detail.start();\n                context.behavioral_details.push(behavior_detail)\n            });\n        });\n    }\n\n    static toggle_loading(){\n        if(this.loading){\n            // $(\".loading\").hide();\n            this.loading = false;\n        } else {\n            // $(\".loading\").show();\n            this.loading = true;\n        }\n    }\n\n}\n"]}