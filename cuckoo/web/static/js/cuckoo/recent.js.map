{"version":3,"sources":["recent.js"],"names":["Recent","loading","limit","offset","empty_results","params","$","hide","show","is_active","data_filter","parent","hasClass","push","gather_params","self","cb","data","results_callback","toggle_loading","beforesend","CuckooWeb","api_post","html","get_tasks","Object","keys","length","forEach","analysis","i","date_completed_on","date_added_on","hasOwnProperty","getFormattedDate","completed_on","added_on","status","id","identifier","sample","md5","filename_url","category","errors","badge_color","score","append"],"mappings":"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","file":"recent.js","sourcesContent":["/*\n * Copyright (C) 2010-2013 Claudio Guarnieri.\n * Copyright (C) 2014-2016 Cuckoo Foundation.\n * This file is part of Cuckoo Sandbox - http://www.cuckoosandbox.org\n * See the file 'docs/LICENSE' for copying permission.\n *\n */\n\nclass Recent {\n    constructor() {\n        this.loading = false;\n        this.limit = 100;\n        this.offset = 0;\n        this.empty_results = false;\n\n        this.params = {\n            \"cats\": [],\n            \"packs\": [],\n            \"score\": \"\"\n        };\n    }\n\n    toggle_loading(){\n        if(this.loading){\n            $(\".loading\").hide();\n            this.loading = false;\n        } else {\n            $(\".loading\").show();\n            this.loading = true;\n        }\n    }\n\n    gather_params(){\n        // reset everything to default values\n        $(\"div#no_more_results\").hide();\n\n        function is_active(data_filter){\n            return $(`div.nav_container>div a[data-filter=${data_filter}]`).parent().hasClass(\"active\");\n        }\n\n        if(is_active(\"cat_files\")) this.params[\"cats\"].push(\"file\");\n        if(is_active(\"cat_urls\")) this.params[\"cats\"].push(\"url\");\n\n        if(is_active(\"score_0-4\")) {\n            this.params[\"score\"] = \"0-4\";\n        } else if (is_active(\"score_4-7\")) {\n            this.params[\"score\"] = \"4-7\";\n        } else if (is_active(\"score_7-10\")) {\n            this.params[\"score\"] = \"7-10\";\n        }\n\n        //if(is_active('pack_pdf')) this.params['packs'].push('pdf');\n        //if(is_active('pack_office')) this.params['packs'].push('office');\n\n        return this.params\n    }\n\n    /**\n     * Contacts API\n     * @param {Object} [params] - filters\n     * @param {Function} callback - the callback function\n     * @return\n     */\n    get_tasks(){\n        let params = this.gather_params();\n        params[\"offset\"] = this.offset;\n        params[\"limit\"] = this.limit;\n\n        let self = this;\n\n        function cb(data){\n            self.results_callback(data);\n            self.toggle_loading(self);\n        }\n\n        function beforesend(){\n            self.toggle_loading(self);\n        }\n\n        CuckooWeb.api_post(\"api/tasks/recent/\", params, cb, null, beforesend);\n    }\n\n    load(){\n        $(\"#recent>tbody\").html(\"\");\n        this.empty_results = false;\n        this.offset = 0;\n        this.params = {\n            \"cats\": [],\n            \"packs\": [],\n            \"score\": \"\"\n        };\n        this.get_tasks();\n    }\n\n    lazy_load(){\n        this.offset += this.limit;\n        this.get_tasks();\n    }\n\n    results_callback(data){\n        if(Object.keys(data).length == 0){\n            $(\"div#no_more_results\").show();\n            $(\"div#no_more_results>span\").html(\"no more results\");\n            this.empty_results = true;\n        } else {\n            data.forEach(function (analysis, i){\n                let html = \"<tr><td>\";\n\n                html += `<strong>${analysis[\"id\"]}</strong></td><td>`;\n\n                let date_completed_on = \"-\";\n                let date_added_on = \"-\";\n\n                if (analysis.hasOwnProperty(\"completed_on\")) date_completed_on = CuckooWeb.getFormattedDate(analysis.completed_on);\n                if (analysis.hasOwnProperty(\"added_on\")) date_added_on = CuckooWeb.getFormattedDate(analysis.added_on);\n\n                if (analysis.status == \"reported\" || analysis.status == \"failed_analysis\") {\n                    html += `<a href=\"${analysis.id}/summary\"><span class=\"mono\">${date_completed_on}</span></a>`;\n                } else {\n                    html += `<span class=\"mono muted\">${date_added_on}</span>`;\n                }\n\n                html += \"</td><td>\";\n\n                var identifier = \"-\";\n                if(analysis.sample) {\n                    identifier = analysis.sample.md5;\n                }\n\n                if (analysis.status == \"reported\" || analysis.status == \"failed_analysis\") {\n                    html += `<a href=\"${analysis.id}/summary\"><span class=\"mono\">${identifier}</span></a>`;\n                } else {\n                    html += `<span class=\"mono\">${identifier}</span>`;\n                }\n\n                html += \"</td><td>\";\n\n                if (analysis.status == \"reported\" || analysis.status == \"failed_analysis\") {\n                    html += `<a href=\"${analysis.id}/summary\">${analysis.filename_url}</a>`;\n                } else {\n                    html += analysis.category;\n                }\n\n                html += \"</td><td>\";\n\n                if (analysis.status == \"pending\") {\n                    html += '<span class=\"text-muted\">pending</span>';\n                } else if (analysis.status == \"running\") {\n                    html += '<span class=\"text-warning\">running</span>';\n                } else if (analysis.status == \"completed\") {\n                    html += '<span class=\"text-info\">completed</span>';\n                } else if (analysis.status == \"reported\") {\n                    if (analysis.errors) {\n                        html += '<span class=\"text-danger\">';\n                    } else {\n                        html += '<span class=\"text-success\">';\n                    }\n\n                    html += \"reported</span>\";\n                } else {\n                    html += `<span class=\"text-danger\">${analysis.status}</span>`;\n                }\n\n                html += \"</td><td>\";\n\n                let badge_color = \"default\";\n                if(analysis.hasOwnProperty(\"score\")) {\n                    if (analysis.score >= 4 && analysis.score <= 7) badge_color = \"warning\";\n                    else if (analysis.score > 7) badge_color = \"danger\";\n                }\n\n                html += `<span class=\"badge badge-${badge_color}\">score: ${analysis.score}</span>`;\n                html += \"</td></tr>\";\n\n                $(\"table#recent tbody\").append(html);\n            });\n        }\n    }\n}\n"]}