{"version":3,"sources":["src/recent.js"],"names":[],"mappings":"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","file":"recent.js","sourcesContent":["/*\n * Copyright (C) 2010-2013 Claudio Guarnieri.\n * Copyright (C) 2014-2016 Cuckoo Foundation.\n * This file is part of Cuckoo Sandbox - http://www.cuckoosandbox.org\n * See the file 'docs/LICENSE' for copying permission.\n *\n */\n\nclass Recent {\n    constructor() {\n        this.loading = false;\n        this.limit = 100;\n        this.offset = 0;\n        this.empty_results = false;\n\n        this.params = {\n            \"cats\": [],\n            \"packs\": [],\n            \"score\": \"\"\n        };\n    }\n\n    toggle_loading(){\n        if(this.loading){\n            $(\".loading\").hide();\n            this.loading = false;\n        } else {\n            $(\".loading\").show();\n            this.loading = true;\n        }\n    }\n\n    gather_params(){\n        // reset everything to default values\n        $(\"div#no_more_results\").hide();\n\n        function is_active(data_filter){\n            return $(`div.nav_container>div a[data-filter=${data_filter}]`).parent().hasClass(\"active\");\n        }\n\n        if(is_active(\"cat_files\")) this.params[\"cats\"].push(\"file\");\n        if(is_active(\"cat_urls\")) this.params[\"cats\"].push(\"url\");\n\n        if(is_active(\"score_0-4\")) {\n            this.params[\"score\"] = \"0-4\";\n        } else if (is_active(\"score_4-7\")) {\n            this.params[\"score\"] = \"4-7\";\n        } else if (is_active(\"score_7-10\")) {\n            this.params[\"score\"] = \"7-10\";\n        }\n\n        //if(is_active('pack_pdf')) this.params['packs'].push('pdf');\n        //if(is_active('pack_office')) this.params['packs'].push('office');\n\n        return this.params\n    }\n\n    /**\n     * Contacts API\n     * @param {Object} [params] - filters\n     * @param {Function} callback - the callback function\n     * @return\n     */\n    get_tasks(){\n        let params = this.gather_params();\n        params[\"offset\"] = this.offset;\n        params[\"limit\"] = this.limit;\n\n        let self = this;\n\n        function cb(data){\n            self.results_callback(data);\n            self.toggle_loading(self);\n        }\n\n        function beforesend(){\n            self.toggle_loading(self);\n        }\n\n        CuckooWeb.api_post(\"api/tasks/recent/\", params, cb, null, beforesend);\n    }\n\n    load(){\n        $(\"#recent>tbody\").html(\"\");\n        this.empty_results = false;\n        this.offset = 0;\n        this.params = {\n            \"cats\": [],\n            \"packs\": [],\n            \"score\": \"\"\n        };\n        this.get_tasks();\n    }\n\n    lazy_load(){\n        this.offset += this.limit;\n        this.get_tasks();\n    }\n\n    results_callback(data){\n        if(Object.keys(data).length == 0){\n            $(\"div#no_more_results\").show();\n            $(\"div#no_more_results>span\").html(\"no more results\");\n            this.empty_results = true;\n        } else {\n            data.forEach(function (analysis, i){\n                let html = \"<tr><td>\";\n\n                html += `<strong>${analysis[\"id\"]}</strong></td><td>`;\n\n                let date_completed_on = \"-\";\n                let date_added_on = \"-\";\n\n                if (analysis.hasOwnProperty(\"completed_on\")) date_completed_on = CuckooWeb.getFormattedDate(analysis.completed_on);\n                if (analysis.hasOwnProperty(\"added_on\")) date_added_on = CuckooWeb.getFormattedDate(analysis.added_on);\n\n                if (analysis.status == \"reported\" || analysis.status == \"failed_analysis\") {\n                    html += `<a href=\"${analysis.id}/summary\"><span class=\"mono\">${date_completed_on}</span></a>`;\n                } else {\n                    html += `<span class=\"mono muted\">${date_added_on}</span>`;\n                }\n\n                html += \"</td><td>\";\n\n                var identifier = \"-\";\n                if(analysis.sample) {\n                    identifier = analysis.sample.md5;\n                }\n\n                if (analysis.status == \"reported\" || analysis.status == \"failed_analysis\") {\n                    html += `<a href=\"${analysis.id}/summary\"><span class=\"mono\">${identifier}</span></a>`;\n                } else {\n                    html += `<span class=\"mono\">${identifier}</span>`;\n                }\n\n                html += \"</td><td>\";\n\n                if (analysis.status == \"reported\" || analysis.status == \"failed_analysis\") {\n                    html += `<a href=\"${analysis.id}/summary\">${analysis.filename_url}</a>`;\n                } else {\n                    html += analysis.category;\n                }\n\n                html += \"</td><td>\";\n\n                if (analysis.status == \"pending\") {\n                    html += '<span class=\"text-muted\">pending</span>';\n                } else if (analysis.status == \"running\") {\n                    html += '<span class=\"text-warning\">running</span>';\n                } else if (analysis.status == \"completed\") {\n                    html += '<span class=\"text-info\">completed</span>';\n                } else if (analysis.status == \"reported\") {\n                    if (analysis.errors) {\n                        html += '<span class=\"text-danger\">';\n                    } else {\n                        html += '<span class=\"text-success\">';\n                    }\n\n                    html += \"reported</span>\";\n                } else {\n                    html += `<span class=\"text-danger\">${analysis.status}</span>`;\n                }\n\n                html += \"</td><td>\";\n\n                let badge_color = \"default\";\n                if(analysis.hasOwnProperty(\"score\")) {\n                    if (analysis.score >= 4 && analysis.score <= 7) badge_color = \"warning\";\n                    else if (analysis.score > 7) badge_color = \"danger\";\n                }\n\n                html += `<span class=\"badge badge-${badge_color}\">score: ${analysis.score}</span>`;\n                html += \"</td></tr>\";\n\n                $(\"table#recent tbody\").append(html);\n            });\n        }\n    }\n}\n"]}